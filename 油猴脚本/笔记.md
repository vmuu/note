[Tampermonkey](https://so.csdn.net/so/search?q=Tampermonkey&spm=1001.2101.3001.7020)ï¼Œåˆç§° Greasemonkey æ²¹çŒ´è„šæœ¬ï¼Œæ˜¯ä¸€æ¬¾å…è´¹çš„æµè§ˆå™¨æ‰©å±•ï¼Œå¯ç”¨äºç®¡ç†ç”¨æˆ·è„šæœ¬ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯å¯¹æµè§ˆå™¨æ¥å£çš„äºŒæ¬¡å°è£…

æ²¹çŒ´è„šæœ¬å¯ç”¨äºæ›´æ”¹[é¡µé¢å¸ƒå±€](https://so.csdn.net/so/search?q=é¡µé¢å¸ƒå±€&spm=1001.2101.3001.7020)æ ·å¼ã€å®Œæˆé¡µé¢è‡ªåŠ¨åŒ–ã€å»å¹¿å‘Šã€ä¸‹è½½å½±è§†ç­‰åŠŸèƒ½ï¼Œé€‚ç”¨äºä¸»æµçš„æµè§ˆ



- Tampermonkey ç‰¹ç‚¹åŒ…å«ï¼š

  - å†…ç½®çš„ç¼–è¾‘å™¨ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°ç®¡ç†ã€ç¼–è¾‘ç”¨æˆ·è„šæœ¬
  - æ”¯æŒè‡ªåŠ¨æ›´æ–°æ£€æŸ¥åŠŸèƒ½
  - æ ‡ç­¾ä¸­è„šæœ¬è¿è¡ŒçŠ¶æ€é€Ÿè§ˆ
  - å¯ä»¥é€šè¿‡å‹ç¼©æ–‡ä»¶ã€[äº‘å­˜å‚¨](https://so.csdn.net/so/search?q=äº‘å­˜å‚¨&spm=1001.2101.3001.7020)è¿›è¡Œè„šæœ¬å¤‡ä»½åŠè¿˜åŸ

  é€šè¿‡é¢æ¿æ–°å»ºä¸€ä¸ªç”¨æˆ·è„šæœ¬ï¼Œé»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ªæ¨¡æ¿ï¼Œæ¨¡æ¿å†…å®¹å¦‚ä¸‹ï¼š

```javascript
// ==UserScript==
// @name         New Userscript
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       You
// @match        http://*/*
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    // Your code here...
})();
```



## è„šæœ¬ç¼–å†™æ–¹æ³•

### åŠŸèƒ½æ³¨é‡Š


| å±æ€§å      | ä½œç”¨                                                         |
| ----------- | ------------------------------------------------------------ |
| name        | æ²¹çŒ´è„šæœ¬çš„åå­—                                               |
| namespace   | å‘½åç©ºé—´ï¼Œç›¸ä¼¼äºJavaçš„åŒ…åï¼Œç”¨æ¥åŒºåˆ†ç›¸åŒåç§°çš„è„šæœ¬ï¼Œä¸€èˆ¬å†™æˆä½œè€…åå­—æˆ–è€…è€…ç½‘å€å³å¯ä»¥äº† |
| version     | è„šæœ¬ç‰ˆæœ¬ï¼Œæ²¹çŒ´è„šæœ¬çš„å‡çº§ä¼šè¯»å–è¿™ä¸ªç‰ˆæœ¬å·                     |
| description | å½¢å®¹ï¼Œç”¨æ¥å‘Šè¯‰å®¢æˆ·è¿™ä¸ªè„šæœ¬æ˜¯å¹²ä»€ä¹ˆç”¨çš„                       |
| author      | ä½œè€…åå­—                                                     |
| match       | åªæœ‰åŒ¹é…çš„ç½‘å€æ‰ä¼šæ‰§è¡Œå¯¹åº”çš„è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨`*`ä½œä¸ºé€šé…ç¬¦ï¼Œå¦‚ï¼š`http://*`ã€`http://www.baidu.com/*`ç­‰ |
| grant       | æŒ‡å®šè„šæœ¬è¿è¡Œæ‰€éœ€æƒé™ï¼Œå‡å¦‚è„šæœ¬æ‹¥æœ‰ç›¸åº”çš„æƒé™ï¼Œå³å¯ä»¥è°ƒç”¨æ²¹çŒ´æ‰©å±•æä¾›çš„APIä¸æµè§ˆå™¨è¿›è¡Œäº¤äº’ã€‚å‡å¦‚è®¾ç½®ä¸º`none`çš„è¯ï¼Œåˆ™ä¸ä½¿ç”¨æ²™ç®±ç¯å¢ƒï¼Œè„šæœ¬ä¼šç›´æ¥è¿è¡Œåœ¨ç½‘é¡µçš„ç¯å¢ƒä¸­ï¼Œè¿™æ—¶å€™æ— æ³•ä½¿ç”¨å¤§éƒ¨åˆ†æ²¹çŒ´æ‰©å±•çš„APIã€‚å‡å¦‚ä¸æŒ‡å®šçš„è¯ï¼Œæ²¹çŒ´ä¼šé»˜è®¤å¢åŠ å‡ ä¸ªæœ€å¸¸ç”¨çš„API |
| require     | å‡å¦‚è„šæœ¬ä¾èµ–å…¶ä½™jsåº“çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨requireæŒ‡ä»¤ï¼Œåœ¨è¿è¡Œè„šæœ¬ä¹‹å‰å…ˆåŠ è½½å…¶ä½™åº“ï¼Œå¸¸è§ç”¨æ³•æ˜¯åŠ è½½jquery |
| connect     | å½“å®¢æˆ·ä½¿ç”¨GM_xmlhttpRequestè¯·æ±‚è¿œç¨‹æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨connectæŒ‡å®šå…è®¸è®¿é—®çš„åŸŸåï¼Œæ”¯æŒåŸŸåã€å­åŸŸåã€IPåœ°å€ä»¥åŠ`*`é€šé…ç¬¦ |
| updateURL   | è„šæœ¬å‡çº§ç½‘å€ï¼Œå½“æ²¹çŒ´æ‰©å±•æ£€æŸ¥å‡çº§çš„æ—¶å€™ï¼Œä¼šå°è¯•ä»è¿™ä¸ªç½‘å€ä¸‹è½½è„šæœ¬ï¼Œè€Œåæ¯”å¯¹ç‰ˆæœ¬å·ç¡®è®¤èƒ½å¦å‡çº§ |
| icon        | ç”¨äºæŒ‡å®šè„šæœ¬çš„å›¾æ ‡ï¼Œå¯ä»¥è®¾ç½®ä¸ºå›¾ç‰‡ URL åœ°å€æˆ– base64 çš„å­—ç¬¦ä¸² |
| homepage    | æ˜¯è„šæœ¬çš„å‘å¸ƒä¸»é¡µ                                             |
| license     | æ˜¯è„šæœ¬éµå¾ªçš„å¼€æºåè®®                                         |
| require     | å®šä¹‰è„šæœ¬è¿è¡Œä¹‹å‰éœ€è¦å¼•å…¥çš„å¤–éƒ¨ JSï¼Œæ¯”å¦‚ï¼šjQuery              |
| exclude     | æ’é™¤åŒ¹é…åˆ°çš„ç½‘ç«™                                             |
| run-at      | æŒ‡å®šè„šæœ¬çš„è¿è¡Œæ—¶æœº                                           |
| connect     | ç”¨äºè·¨åŸŸè®¿é—®æ—¶æŒ‡å®šçš„ç›®æ ‡ç½‘ç«™åŸŸå                             |
|             |                                                              |

### è„šæœ¬æƒé™

ä¸‹é¢ç®€å•è¯¦æƒ…ä¸€ä¸‹grantæŒ‡ä»¤é‚£é‡Œå¯ä»¥å¡«å†™çš„å°‘é‡æƒé™ï¼Œä»‹ç»è¯·æŸ¥çœ‹æ²¹çŒ´è„šæœ¬æ–‡æ¡£ã€‚è¿™é‡Œå°±ç®€å•è¯¦æƒ…å‡ ä¸ªå¸¸ç”¨çš„ï¼Œå¯ä»¥è°ƒç”¨çš„å‡½æ•°ä¸€å¾‹ä»¥GM_ä½œä¸ºå¼€å¤´ã€‚

| æƒé™å                                                       | åŠŸèƒ½                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| unsafeWindow                                                 | å…è®¸è„šæœ¬å¯ä»¥å®Œæ•´è®¿é—®åŸå§‹é¡µé¢ï¼ŒåŒ…æ‹¬åŸå§‹é¡µé¢çš„è„šæœ¬å’Œå˜é‡ã€‚     |
| GM_getValue(name,defaultValue)                               | ä»æ²¹çŒ´æ‰©å±•çš„å­˜å‚¨ä¸­è®¿é—®æ•°æ®ã€‚å¯ä»¥è®¾ç½®é»˜è®¤å€¼ï¼Œåœ¨æ²¡æˆåŠŸè·å–åˆ°æ•°æ®çš„æ—¶å€™å½“åšåˆå§‹å€¼ã€‚å‡å¦‚ä¿å­˜çš„æ˜¯æ—¥æœŸç­‰ç±»å‹çš„è¯ï¼Œå–å‡ºæ¥çš„æ•°æ®ä¼šå˜æˆæ–‡æœ¬ï¼Œéœ€è¦è‡ªå·±è½¬æ¢ä¸€ä¸‹ã€‚ |
| GM_setValue(name,value)                                      | å°†æ•°æ®ä¿å­˜åˆ°å­˜å‚¨ä¸­                                           |
| GM_xmlhttpRequest(details)                                   | å¼‚æ­¥è®¿é—®ç½‘é¡µæ•°æ®çš„APIï¼Œè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œæœ‰å¤§é‡å‚æ•°å’Œå›è°ƒï¼Œä»‹ç»è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ |
| GM_setClipboard(data, info)                                  | å°†æ•°æ®å¤åˆ¶åˆ°å‰ªè´´æ¿ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦å¤åˆ¶çš„æ•°æ®ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯MIMEç±»å‹ï¼Œç”¨äºæŒ‡å®šå¤åˆ¶çš„æ•°æ®ç±»å‹ã€‚ |
| GM_log(message)                                              | å°†æ—¥å¿—æ‰“å°åˆ°æ§åˆ¶å°ä¸­ï¼Œå¯ä»¥ä½¿ç”¨F12å¼€å‘è€…å·¥å…·æŸ¥çœ‹ã€‚            |
| GM_addStyle(css)                                             | åƒç½‘é¡µä¸­å¢åŠ è‡ªå·±çš„æ ·å¼è¡¨ã€‚                                   |
| GM_notification(details, ondone), GM_notification(text, title, image, onclick) | è®¾ç½®ç½‘é¡µé€šçŸ¥ï¼Œè¯·å‚è€ƒæ–‡æ¡£è·å–ç”¨æ³•ã€‚                           |
| GM_openInTab(url, loadInBackground)                          | åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ç½‘é¡µï¼Œå¯ä»¥è®¾ç½®èƒ½å¦åœ¨åç«¯æ‰“å¼€ç­‰å‡ ä¸ªé€‰é¡¹         |

è¿˜æœ‰å°‘é‡APIæ²¡æœ‰è¯¦æƒ…ï¼Œè¯·å¤§å®¶ç›´æ¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£å§ã€‚



## åŸºæœ¬æ“ä½œ

### æ‰“å°æ—¥å¿—æ“ä½œ

ç”¨äºåœ¨æ§åˆ¶å°ä¸­æ‰“å°æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•

```javascript
// æˆæƒ  
@grant GM_log  
  
// åœ¨æ§åˆ¶å°æ‰“å°æ—¥å¿—  
GM_log("Hello World");  

```

### ç¼“å­˜ç®¡ç†

åŒ…å«å¯¹ç¼“å­˜çš„æ–°å¢ã€è·å–ã€åˆ é™¤ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰æˆ‘ä»¬éƒ½éœ€è¦ä½¿ç”¨å…³é”®å­— @grant è¿›è¡Œæˆæƒ

```javascript
//æˆæƒ  
// @grant        GM_setValue  
// @grant        GM_getValue  
// @grant        GM_deleteValue  
  
//è®¾ç½®ç¼“å­˜  
GM_setValue("hello", true);  
  
//è·å–ç¼“å­˜ï¼Œé»˜è®¤å€¼ä¸ºtrue  
GM_getValue("hello", true);  
  
//åˆ é™¤ç¼“å­˜  
GM_deleteValue("hello")  

```

### ç¼“å­˜ç›‘å¬

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç¼“å­˜ä¸­çš„æŸä¸ªé”®çš„å€¼è¿›è¡Œç›‘å¬ï¼Œå½“å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè°ƒç”¨ä¸€ä¸ªæ–¹æ³•äº‹ä»¶

æ¯”å¦‚ï¼Œè¿™é‡Œæ–°å¢äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œå¯¹é”®åä¸º hello çš„å€¼è¿›è¡Œç›‘å¬

```javascript
// æˆæƒ  
// @grant        GM_addValueChangeListener  
// @grant        GM_removeValueChangeListener  
  
// æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨  
const listener_id = GM_addValueChangeListener('hello', function(name, old_value, new_value, remote){  
            if(hello == false){  
                //å…·ä½“çš„è°ƒç”¨æ–¹æ³•  
                //....  
            }  
})  
  
//ç›‘å¬ç›‘å¬å™¨  
GM_removeValueChangeListener(listener_id);  

```

### æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾

æ ¼å¼ï¼šGM_openInTab(url, options)

è¯¥ API å¯ç”¨äºæ‰“å¼€ä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µé¢

å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºæŒ‡å®šæ–°æ ‡ç­¾é¡µé¢çš„ URL åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨äºæŒ‡å®šé¡µé¢å±•ç¤ºæ–¹å¼åŠç„¦ç‚¹åœç•™é¡µé¢

```javascript
// æˆæƒ  
// @grant        GM_openInTab  
  
// æ‰“å¼€æ–°é¡µé¢  
var onpenNewTap = function (){  
    //æ‰“å¼€ç™¾åº¦é¡µé¢  
    //active:trueï¼Œæ–°æ ‡ç­¾é¡µè·å–é¡µé¢ç„¦ç‚¹  
    //setParent :true:æ–°æ ‡ç­¾é¡µé¢å…³é—­åï¼Œç„¦ç‚¹é‡æ–°å›åˆ°æºé¡µé¢  
    newTap = GM_openInTab("https://www.baidu.com",{ active: true, setParent :true});  
...

```

### è·¨åŸŸè¯·æ±‚

åœ¨æˆäºˆ GM_xmlhttpRequest æƒé™ä¹‹åï¼Œå°±å¯ä»¥è·¨åŸŸå‘é€è¯·æ±‚äº†

PSï¼šç¬¬ä¸€æ¬¡è·¨åŸŸè¯·æ±‚æ—¶ï¼Œä¼šå¼¹å‡ºè¯·æ±‚å¯¹è¯æ¡†ï¼Œéœ€è¦é€‰ä¸­å…è®¸ï¼Œæ‰èƒ½æ­£å¸¸è¿›è¡Œè·¨åŸŸè¯·æ±‚

```javascript
// æˆæƒ  
// @grant        GM_xmlhttpRequest  
  
...  
GM_xmlhttpRequest({  
    url:"http://www.httpbin.org/post",  
    method:'POST',  
    headers: {  
    "content-type": "application/json"  
      },  
    data:"",  
    onerror:function(res){  
        console.log(res);  
    },  
    onload:function(res){  
        console.log(res);  
    }  
});  
...

```

### ç‹ä¸€ä¹‹ï¼šè„šæœ¬å¾€é¡µé¢æ·»åŠ æ–°å…ƒç´ 

[æ²¹çŒ´è„šæœ¬å¼€å‘æŒ‡å—]è„šæœ¬å¾€é¡µé¢ä¸Šæ·»åŠ æ–°å…ƒç´ 
https://bbs.tampermonkey.net.cn/thread-237-1-1.html

#### æœ¬èŠ‚ä¸»è¦å†…å®¹

> ä»‹ç»ä½¿ç”¨è„šæœ¬å¾€å‰ç«¯é¡µé¢æ’å…¥æŒ‰é’®æˆ–è€…ä¸€ä¸ªå°æ¡†æ¡†ä¹‹ç±»çš„å…ƒç´ .æœ€åå¼„ä¸€ä¸ªç»™bç«™çœŸÂ·ä¸€é”®ä¸‰è¿çš„æŒ‰é’®.(æœ‰å…´è¶£ä¹Ÿå¯ä»¥å†™äºŒè¿,å¤ªè€—ç¡¬å¸äº†T T)
> æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å¼„ä¸€ä¸ªè¯„è®ºåˆ—è¡¨æ¥å®æˆ˜,æœ¬æ¥æ˜¯æƒ³åœ¨æœ¬èŠ‚ä¸­å¼„çš„,ä½†æ˜¯ç¯‡å¹…æœ‰é™,æš‚æ—¶æ”¾å¼ƒå§.æƒ³çš„è¯å¯ä»¥åé¦ˆä¸€ä¸‹,æˆ‘å®‰æ’åˆ°ä¸‹ä¸€èŠ‚.
> (æœ¬æ¥æ˜¯æƒ³å†å¼„ä¸€ä¸ªå¼¹å¹•åˆ—è¡¨çš„é¡µé¢çš„,ä½†æ˜¯æ„Ÿè§‰éš¾åº¦å¤ªé«˜äº†,ä¸å¤ªåˆé€‚åšæ•™ç¨‹.)

#### è„šæœ¬å¾€é¡µé¢æ·»åŠ æ–°å…ƒç´ 

> è„šæœ¬å¾€é¡µé¢å¢åŠ æ–°å…ƒç´ è¿™ç§éœ€æ±‚ç»å¸¸å¯è§,ä¾‹å¦‚ç™¾åº¦äº‘çš„è„šæœ¬,å°±ä¼šå¾€é¡µé¢ä¸Šæ·»åŠ ä¸€äº›è§£æé“¾æ¥ä¹‹ç±»çš„æŒ‰é’®,ä¸€äº›åŠ©æ‰‹ç±»å‹çš„ä¼šå¾€é¡µé¢ä¸Šæ·»åŠ ä¸€äº›å°çª—å£,æ˜¾ç¤ºè„šæœ¬çš„è¿è¡ŒçŠ¶æ€ç­‰ç­‰.

å¦‚æœè¦è®©è„šæœ¬å¾€é¡µé¢ä¸Šæ·»åŠ æ–°å…ƒç´ ,åŸç†å¾ˆç®€å•.

é¦–å…ˆä½¿ç”¨ `document.createElement`åˆ›å»ºå¥½ä½ æƒ³æ’å…¥çš„å…ƒç´ ,ä¾‹å¦‚æŒ‰é’®å°± `document.createElement("button")`,å¦‚æœä½ æœ‰å¾ˆå¤šç»„ä»¶æƒ³æ”¾è¿›å»çš„è¯å¯ä»¥ç”¨ `document.createElement("div")`,ç„¶åå¾€elementé‡Œçš„innerHTMLç›´æ¥å†™htmlä»£ç .

ç„¶åæ‰¾åˆ°ä½ æƒ³æ’å…¥çš„ä½ç½®,ä½¿ç”¨ `append/insertBefore`ä¹‹ç±»çš„æ–¹æ³•æ’å…¥ä½ çš„element.ä¹‹åå°±å¯ä»¥åœ¨ `F12 å¼€å‘è€…å·¥å…·`ä¸­çš„ `element`ä¸­çœ‹åˆ°æˆ‘ä»¬æ’å…¥çš„å†…å®¹äº†.

[append](https://developer.mozilla.org/zh-CN/docs/Web/API/ParentNode/append),[appendChild](https://developer.mozilla.org/zh-CN/docs/Web/API/Node/appendChild),[prepend](https://developer.mozilla.org/zh-CN/docs/Web/API/ParentNode/prepend),[insertBefore](https://developer.mozilla.org/zh-CN/docs/Web/API/Node/insertBefore),å…·ä½“æ–¹æ³•å’ŒåŒºåˆ«å¯ä»¥è‡ªè¡Œç™¾åº¦æœç´¢å’ŒæŸ¥çœ‹æ–‡æ¡£(å…¶å®æ˜¯æˆ‘å«Œéº»çƒ¦,æ•´ç†ä¸€ä¸‹åˆå¯ä»¥æ°´ä¸€ç¯‡äº†)

åƒä¸‹é¢çš„ä»£ç ,æ’å…¥åˆ°äº†æœ€åé¢

![image-20210123121141630.png](https://bbs.tampermonkey.net.cn/data/attachment/forum/202101/23/152818pgso4gg43aog62yz.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300)

å½“ç„¶ä¸Šè¿°æ˜¯çš„åŸç”Ÿçš„æ–¹æ³•,ä¾‹å¦‚æœ‰äº›ç½‘é¡µè‡ªå¸¦jQuery,é‚£ä¹ˆå¯ä»¥ç”¨ `$("

htmlä»£ç 

")`ä¹‹ç±»çš„æ–¹å¼å»åˆ›å»ºå…ƒç´ ,å†ç”¨jQueryçš„`append`ä¹‹ç±»çš„æ–¹æ³•æ’å…¥åˆ°é¡µé¢ä¸­å».æœ¬ç³»åˆ—å†…å®¹è¿˜æ˜¯ä½¿ç”¨åŸç”Ÿçš„æ¥è¿›è¡Œè®²è§£å’Œä½¿ç”¨.



#### æ–°å…ƒç´ çš„äº‹ä»¶ç›‘å¬

\> å…ƒç´ æ˜¯æ·»åŠ è¿›å»äº†,ä½†æ˜¯åªèƒ½çœ‹åˆä¸èƒ½ç”¨é‚£æœ‰å•¥ç”¨.æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç›‘å¬æˆ‘ä»¬çš„å…ƒç´ äº‹ä»¶,æœ€å¸¸ç”¨çš„å°±æ˜¯ `click`ç‚¹å‡»äº‹ä»¶,ç‚¹äº†æˆ‘ä»¬çš„æŒ‰é’®,è®©æˆ‘ä»¬çš„è„šæœ¬åšå‡ºä¸€äº›ååº”.

å¦‚æœæ˜¯ç±»ä¼¼æŒ‰é’®çš„æ–¹å¼,æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™.ç›´æ¥çš„ä½¿ç”¨onclickçš„æ–¹æ³•.

```js
let btn=document.createElement("button");
btn.innerHTML="æŒ‰é’®æ–‡å­—,å…¶å®ä¹Ÿå¯ä»¥å†™html,å˜æˆä¸‹é¢çš„æ ·å­(ä¸è¿‡è°ç”¨æŒ‰é’®æ¥åŒ…é‚£ä¹ˆå¤šhtmlæ ‡ç­¾å‘¢)";//innerTextä¹Ÿå¯ä»¥,åŒºåˆ«æ˜¯innerTextä¸ä¼šè§£æhtml
btn.onclick=function(){
    //code
    alert("ç‚¹å‡»äº†æŒ‰é’®");
}
document.body.append(btn);
```

å¦‚æœæ˜¯ä¸€ä¸ªdiv,åœ¨é‡Œé¢å†™htmlè‡ªç”±å‘æŒ¥,å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼.eventè¯¦ç»†è¯´æ˜:[Event](https://developer.mozilla.org/zh-CN/docs/Web/API/Event)

```js
let div=document.createElement("div");
div.innerHTML='<span id="span-1">span1</span><span class="sp">span class</span>';
div.onclick=function(event){
    if(event.target.id=="span-1"){
        alert("span-1è¢«ç‚¹å‡»äº†");
    }else if(event.target.className=="sp"){
        alert("spè¿™ä¸€ç±»è¢«ç‚¹äº†");
    }
};
document.body.append(div);
```

è‡³äºä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„åŒºåˆ«,ç®€å•æ¥è¯´å°±æ˜¯å‰ä¸€ç§æ–¹æ³•æˆ‘ä»¬**ç›‘å¬**çš„åªæœ‰ä¸€ä¸ªå…ƒç´ ,é‚£æˆ‘ä»¬è‚¯å®šå°±çŸ¥é“å°±åªå¯èƒ½æ˜¯è¿™ä¸€ä¸ªæ‰§è¡Œçš„æ“ä½œ.

åé¢çš„å› ä¸ºé‡Œé¢åŒ…å«äº†å¤šä¸ªå…ƒç´ ,æˆ‘ä»¬å°±å¯ä»¥ä»eventé‡Œé¢æ‰¾åˆ°å®é™…è¢«ç‚¹å‡»çš„å…ƒç´ ,é€šè¿‡idæˆ–è€…classå»åˆ¤æ–­,æ¥èµ°æˆ‘ä»¬çš„è„šæœ¬æ‰§è¡Œæµç¨‹.

å¦å¤–å†è¡¥å……ä¸€ä¸‹,ä¸Šé¢çš„onclickå¯ä»¥æ”¹å†™æˆaddEventListener("click"),ç±»ä¼¼ä¸‹é¢è¿™æ ·.

```js
div.addEventListener("click",function(ev){
    console.log(ev);
});
```

ä¸»è¦åŒºåˆ«onclickåªèƒ½ç»‘å®šä¸€ä¸ªfunction,addEventListenerå¯ä»¥ç»‘å®šå¤šä¸ª,è¿™åˆæ¶‰åŠäº†å‰ç«¯çš„å†…å®¹,å¤§å®¶å¯ä»¥è¯¾åè¡¥ä¹ ä¸€ä¸‹,å¯ä»¥çœ‹ä¸€ä¸‹[addEventListener](https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener)çš„è¯´æ˜.ä¹Ÿè¿˜æœ‰å…¶å®ƒçš„ç»‘å®šäº‹ä»¶çš„æ–¹æ³•,è¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†.

å¯¹äºç›‘å¬é¡µé¢ä¸Šå·²ç»æœ‰çš„æŒ‰é’®,æ¨èç”¨addEventListener,ä»¥é˜²onclickå°†åŸæ¥çš„æŒ‰é’®äº‹ä»¶è¦†ç›–æ‰(å¦‚æœæŒ‰é’®ä¹Ÿæ˜¯ç”¨onclickçš„è¯),çœ‹æƒ…å†µè€Œå®š.

è€Œä¸”ä¹Ÿå¯ä»¥åœ¨äº‹ä»¶ä¸­ `return false;`ä½¿äº‹ä»¶ä¸å†å‘ä¸Šä¼ é€’.(æœ‰ç‚¹æ‰¯è¿œäº†,å°±éšå£æä¸€å¥ğŸ˜‚,è¡¥å……ä¸€äº›è„šæœ¬çš„å¼€å‘å°æŠ€å·§,å°±åƒæ˜¯è¡¥å……å†…åŠ›ä¸€æ ·,ä»¥é˜²è¸©å‘,ä¸‡ä¸€é‡åˆ°äº†å‘¢,ä¸å¯èƒ½æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯å®Œå…¨æŒ‰ç…§æ•™ç¨‹æ¥çš„.æœ‰å…´è¶£çš„å¯ä»¥è¯¾å¤–å»ç»†ç©¶,ä¹Ÿå¯ä»¥ç•¥è¿‡æœ‰ä¸ªå°è±¡å°±å¥½.)

#### æ–°å…ƒç´ çš„style

ä¸ºäº†å¥½çœ‹æˆ–è€…æ”¾åœ¨ç½‘é¡µä¸­ä¸çªå…€,æˆ‘ä»¬å¯ä»¥åŠ ä¸Šç½‘é¡µè‡ªå¸¦çš„classæˆ–è€…è‡ªå·±å†™ä¸€äº›æ ·å¼,ç±»ä¼¼ä¸‹é¢è¿™æ ·:

```js
btn.className="default-btn";//æ·»åŠ class
btn.id="submit-btn";//æ·»åŠ id
btn.style.color="#ff0000";//ç»™æŒ‰é’®å†™styleæ ·å¼,æŸ¥çœ‹è¿™ä¸ªæ–‡æ¡£,çœ‹cssä¸JavaScriptçš„å¯¹åº”:https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Properties_Reference
div.innerHTML='<span id="span-1" class="span-class" style="font-size:12px">span1</span><span class="sp" style="color:red">span class</span>';//åœ¨htmlé‡Œå†™style
```

#### bilibiliçœŸÂ·ä¸€é”®ä¸‰è¿

\> ä¸Šé¢çš„å†…å®¹è¯´å®Œå,æ¥åšç‚¹å®é™…çš„ä¸œè¥¿,æœŸæœ›åœ¨é¡µé¢ä¸Šçš„æ”¶è—æŒ‰é’®å’Œåˆ†äº«æŒ‰é’®ä¸­é—´å¢åŠ ä¸€ä¸ªä¸‰è¿æŒ‰é’®

![image-20210123130836474.png](https://bbs.tampermonkey.net.cn/data/attachment/forum/202101/23/152833chqacnmenz1n8v8h.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300)

æˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡ `F12å¼€å‘è€…å·¥å…·`æ‰¾åˆ°è¿™ä¸€å—çš„å…ƒç´ ,å‘ç°æ˜¯ç”¨çš„span,ä¸ºäº†æ ·å­ä¸€æ ·æˆ‘ä»¬å¯ä»¥ç”¨spanæ¥åˆ›å»º.ä¸è¿‡!ä¸ºäº†æ–¹ä¾¿,æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨button,å¤§å®¶ä¹Ÿå¯ä»¥å½“ä½œè¯¾åä½œä¸šå»å®Œå–„.(å®é™…ä¸Šä¹Ÿæ²¡ä»€ä¹ˆå›¾æ ‡,ç›´æ¥ç”¨æŒ‰é’®å¾—äº†)

![image-20210123131021747.png](https://bbs.tampermonkey.net.cn/data/attachment/forum/202101/23/152919szjuubzezdwkdgb0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300)

åˆ›å»ºä»£ç å¦‚ä¸‹:

```js
let triple=document.createElement("button");
triple.innerText="ä¸‰è¿";
triple.style.background="#757575";//é¢œè‰²å¼„å¾—å·®ä¸å¤šå§
triple.style.color="#fff";
triple.onclick=function(){
    //ä¸‰è¿ä»£ç 
};
```

æ’å…¥æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°shareçš„çˆ¶èŠ‚ç‚¹,ç„¶åä½¿ç”¨insertBefore,åœ¨shareä¹‹å‰æ’å…¥æˆ‘ä»¬çš„ä¸‰è¿æŒ‰é’®,ä»£ç å¦‚ä¸‹:

```js
let share=document.querySelector('.share');
share.parentElement.insertBefore(triple,share);
```

emmmmå¥½ä¸‘,å…ˆè¿™æ ·å§,åŠŸèƒ½æ˜¯å¯ä»¥çš„å°±è¡ŒğŸ˜‚

![image-20210123140056733.png](https://bbs.tampermonkey.net.cn/data/attachment/forum/202101/23/152841wzqpw0wunqst8kud.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300)

ä¸è¿‡ç›´æ¥çš„è¿™æ ·æ’å…¥æ˜¯ä¸è¡Œçš„,æœ€ç»ˆä»£ç ç±»ä¼¼è¿™æ ·,æ¯”è¾ƒå¤æ‚éœ€è¦æœ‰ç‚¹DOMä¹‹ç±»çš„çŸ¥è¯†æ‰å¥½ç†è§£,æš‚æ—¶ä¸å±•å¼€å§,ä¹Ÿæš´åŠ›ä¸€ç‚¹ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ `setTimeout`ç­‰ä¸€æ®µæ—¶é—´å†æ’å…¥,ä¸”run-atè®¾ç½®ä¸ºdocument-end.

```js
let ops=document.querySelector('#arc_toolbar_report .ops');
//æ’å…¥ä¸‰è¿ä¹‹åå¥½åƒä¼šé‡æ–°ç”Ÿæˆ,ä¸æ·»åŠ å°±ä¸ä¼šé‡æ–°ç”Ÿæˆ,æš‚æ—¶æ²¡å¼„æ¸…ä»€ä¹ˆæƒ…å†µ,å…ˆè¿™æ ·å¤„ç†äº†.
//ä¸»è¦ä½œç”¨æ˜¯ç›‘å¬opsçš„DOMNodeInsertedäº‹ä»¶,ç­‰å®ƒä¿®æ”¹å®Œæˆä¹‹åå†æ’å…¥æˆ‘ä»¬çš„ä¸‰è¿æŒ‰é’®,å¦å¤–æ³¨æ„run-atæ˜¯document-end,è¦ç­‰å¾…opsç”Ÿæˆä¹‹åå†ç›‘å¬,ä¸ç„¶queryè¿”å›nullä¼šæŠ¥é”™
//è¿™ä¸ªäº‹ä»¶ä¼šå¤šæ¬¡è°ƒç”¨,ä½†æ˜¯æˆ‘ä»¬insertBeforeæ’å…¥å¦‚æœå…ƒç´ å­˜åœ¨,åªæ˜¯ä¿®æ”¹è€Œä¸ä¼šæ–°å¢
ops.addEventListener("DOMNodeInserted", function(event) {
    let share=document.querySelector('.share');
    share.parentElement.insertBefore(triple,share);
});
```

ç„¶åæˆ‘ä»¬å¯ä»¥é•¿æŒ‰å¤§æ‹‡æŒ‡,æŠ“ä¸€ä¸‹ä¸‰è¿çš„httpè¯·æ±‚,å°±åƒä¸Šä¸€èŠ‚çš„ajaxè‡ªåŠ¨å…³æ³¨upä¸»ä¸€æ ·

![image-20210123140304599.png](https://bbs.tampermonkey.net.cn/data/attachment/forum/202101/23/152933g8za4zgq6jnhw88j.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300)

aidæ˜¯æˆ‘ä»¬çš„è§†é¢‘id,csrfçš„åœ¨[cookie](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie)é‡Œé¢,è¿™é‡Œå°±æš‚æ—¶ä¸ç»†è¯´äº†,å› ä¸ºæˆ‘ä»¬å°±æ˜¯åœ¨bilibiliçš„é¡µé¢ä¸Š,æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨GMè·¨åŸŸ(æ‰€ä»¥æˆ‘çš„grantæ˜¯none,ä¸éœ€è¦æ²™ç›’ç¯å¢ƒ,å¦å¤–ç”¨unsafeWindowä¹ŸæŒºéº»çƒ¦çš„),è€Œä¸”ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡cookieå–åˆ°csrf,ç›´æ¥ç”¨xhrè¯·æ±‚æ¥å£å°±è¡Œäº†.ä»£ç å¦‚ä¸‹:

```js
let httpRequest = new XMLHttpRequest();
httpRequest.open('POST', 'https://api.bilibili.com/x/web-interface/archive/like/triple');
httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");
httpRequest.withCredentials = true;//è®¾ç½®è·¨åŸŸå‘é€å¸¦ä¸Šcookie
let aid=window.__INITIAL_STATE__.aid;
let sKey="bili_jct";
let csrf=decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*" + encodeURIComponent(sKey).replace(/[-.+*]/g, "\\$&amp;") + "\\s*\\=\\s*([^;]*).*$)|^.*$"), "$1")) || null;
//ä¸Šé¢è¿™ä¸€æ®µå°±æ˜¯å–å‡ºcsrf,åœ¨cookieé‡Œé¢æ˜¯bili_jct,è¿™ä¸€æ®µæˆ‘æ˜¯ç›´æ¥copyçš„,æ€»ä¹‹è·å–åˆ°å°±å¥½äº†å•¦
httpRequest.send('aid='+aid+'&amp;csrf='+csrf);
httpRequest.onreadystatechange = function () {
    if (httpRequest.readyState == 4 &amp;&amp; httpRequest.status == 200) {
        var json = JSON.parse(httpRequest.responseText);
        console.log(json);
        if(json.code==0){
           alert("ä¸‰è¿æˆåŠŸ!åˆ·æ–°é¡µé¢å¯è§");
        }else{
            alert("ä¸‰è¿å¤±è´¥/(ã„’oã„’)/~~");
        }
    }
};
```

ä¸Šè¿°å–csrfä»£ç æ¥è‡ª:[Document.cookie](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookieä¸€ä¸ªå°æ¡†æ¶ï¼šä¸€ä¸ªå®Œæ•´æ”¯æŒunicodeçš„cookieè¯»å–å†™å…¥å™¨)

#### end

æˆ‘ä»¬è„šæœ¬æœ¬æ¬¡ç”¨äº† `run-at`,`grant none`,è¿™æ˜¯ä¹‹å‰å­¦ä¹ è¿‡çš„,å¤§å®¶å¯ä»¥å¤šå¤šæ³¨æ„ä¸€ä¸‹,æœ€åè„šæœ¬ä»£ç ä¼šå‘åˆ°è„šæœ¬å‘å¸ƒåŒº,å¤§å®¶å¯ä»¥å»è¯•è¯•çœ‹çœ‹å®Œæ•´ä»£ç .

bilibiliä¸‰è¿æŒ‰é’®demo
https://bbs.tampermonkey.net.cn/thread-238-1-1.html
(å‡ºå¤„: æ²¹çŒ´ä¸­æ–‡ç½‘)

### ç‹ä¸€ä¹‹ï¼šå¤–éƒ¨èµ„æºå¼•ç”¨

[æ²¹çŒ´è„šæœ¬å¼€å‘æŒ‡å—]å¤–éƒ¨èµ„æºå¼•ç”¨
https://bbs.tampermonkey.net.cn/thread-249-1-1.html

#### æœ¬èŠ‚ä¸»è¦å†…å®¹

\> å¼•å…¥å¤–éƒ¨èµ„æº,ä¾‹å¦‚jQuery,vue,å’Œè‡ªå·±å†™çš„ä¸€äº›cssæ ·å¼,jsè„šæœ¬ç­‰.æœ€ç»ˆå†™ä¸€ä¸ªè„šæœ¬ç»™è®ºå›å¢åŠ ä¸€ä¸ªé»‘å¤œæ¨¡å¼(èƒŒæ™¯å…¨æ˜¯é»‘çš„).

#### jsèµ„æºçš„å¼•ç”¨

æœ‰äº›æ—¶å€™å¯ä»¥å¼•å…¥ä¸€äº›jsèµ„æºæ–‡ä»¶å¸®åŠ©æˆ‘ä»¬æ›´åŠ æ–¹ä¾¿çš„å¼€å‘è„šæœ¬,ä¾‹å¦‚å¼•å…¥jQuery,vueç­‰æ¡†æ¶.å½“ç„¶è¿˜æœ‰å…¶å®ƒæ›´å¤šçš„ç”¨æ³•,ä¾‹å¦‚è„šæœ¬åŠ ä¸Šé‰´æƒ,è„šæœ¬urlååŠ ä¸€äº›tokenç­‰ç­‰.

#### ä½¿ç”¨@requireåŠ è½½

æ²¹çŒ´ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª[@require](https://www.tampermonkey.net/documentation.php#_require)å±æ€§ç»™æˆ‘ä»¬æ¥å¼•ç”¨ç”¨æˆ·è„šæœ¬,å¹¶ä¸”æ²¹çŒ´ç»™æˆ‘ä»¬æä¾›äº†md5,sha256ç­‰æ ¡éªŒæ–¹æ³•æ¥æ ¡éªŒå¼•ç”¨çš„è„šæœ¬æ˜¯å¦æ­£ç¡®,ä¾‹å¦‚ä¸‹é¢è¿™æ ·:

```
// @require      https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.min.js
```

å¦‚æœmd5ä¸æ­£ç¡®,consoleä¸­åˆ™ä¼šæ˜¾ç¤ºä¸‹é¢çš„å†…å®¹

![image-20210128111926953.png](https://bbs.tampermonkey.net.cn/data/attachment/forum/202101/28/164854lfii1l6zteit4oit.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300)

å¦‚æœæ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼å¼•å…¥çš„è¯,é‚£ä¹ˆå¼•å…¥çš„**jsæ‰§è¡Œçš„ä¸Šä¸‹æ–‡**æ˜¯åœ¨æ²¹çŒ´çš„ç¯å¢ƒä¸­,å¯èƒ½ä¼šå¯¼è‡´jsæ— æ³•æ­£å¸¸æ‰§è¡Œ,ä¾‹å¦‚æ²™ç›’ç¯å¢ƒä¸­æ“ä½œå‰ç«¯windowæ˜¯éœ€è¦ä½¿ç”¨ `grant unsafeWindow`,å¼•å…¥çš„jsæ–‡ä»¶å¯èƒ½å¹¶ä¸ä¼šè€ƒè™‘è¿™äº›.ä¸€ä¸ªå°å‘éœ€è¦æ³¨æ„.

å¦å¤–å¦‚æœ `grant none`è¿è¡Œåœ¨éæ²™ç®±çš„æƒ…å†µä¸‹,jsä»£ç å¯èƒ½ä¼šä¸å‰ç«¯å†²çª(ä¾‹å¦‚å‰ç«¯å¼•å…¥äº†ä¸€æ¬¡jQuery,è¿™é‡Œåˆrequireäº†ä¸€æ¬¡jQuery),å¯ä»¥ä½¿ç”¨æ²™ç®±æ¨¡å¼è¿è¡Œ,è¿™æ ·åªå­˜åœ¨æ²™ç®±çš„ä¸Šä¸‹æ–‡ä¸­,ä¸ä¼šå½±å“åˆ°å‰ç«¯,ä¸è¿‡è¿™ç§æƒ…å†µ,å¯ä»¥ç›´æ¥ä½¿ç”¨å‰ç«¯çš„js,å¦‚æœç‰ˆæœ¬ç¬¦åˆä½ çš„éœ€æ±‚çš„è¯.

æ²™ç›’ä¸­çš„documentçš„å¯ä»¥æ­£å¸¸ä½¿ç”¨,æ‰€ä»¥å¯ä»¥å¼•ç”¨vue,jqueryä¹‹ç±»çš„æ¡†æ¶,ä½†æ˜¯å¦‚æœjsè„šæœ¬æ¶‰åŠåˆ°windowçš„æ“ä½œ,éœ€è¦ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•.

ä½¿ç”¨è„šæœ¬åŠ è½½

\> å¯¹äºä¸Šé¢çš„å°å‘å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•è§£å†³

åœ¨æˆ‘ä»¬çš„è„šæœ¬ä¸­å†™å¦‚ä¸‹ä»£ç ,åŸç†å°±æ˜¯å¾€æˆ‘ä»¬çš„é¡µé¢ä¸­åŠ å…¥scriptæ ‡ç­¾å»åŠ è½½jsæ–‡ä»¶.éœ€è¦æ³¨æ„çš„æ˜¯,headæ ‡ç­¾,bodyæ ‡ç­¾ç­‰ä¸åŒçš„ä½ç½®ä¸­æ’å…¥,jsåŠ è½½çš„æ—¶é—´æ˜¯ä¸åŒçš„,ä¸è¿‡ä¸€èˆ¬onloadä¹‹åå†æ‰§è¡Œè„šæœ¬ä¸€èˆ¬æ²¡é—®é¢˜.(æ³¨æ„è„šæœ¬çš„ `run-at`å±æ€§,æœ€å¥½æ˜¯ `start`,æ€»ä¹‹å°±æ˜¯jsåŠ è½½é¡ºåºå’Œè„šæœ¬æ‰§è¡Œé¡ºåºå•¦,åˆ«jsè¿˜æ²¡åŠ è½½å®Œä½ è„šæœ¬å°±å¼€å§‹ç”¨jsäº†)

```
let script = document.createElement('script');
script.setAttribute('type', 'text/javascript');
script.src = "https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.min.js";
document.documentElement.appendChild(script);
```

#### cssèµ„æºçš„å¼•ç”¨

\> å¯ä»¥ä½¿ç”¨cssæ¥æ”¹å˜æˆ‘ä»¬é¡µé¢çš„å¸ƒå±€æ•ˆæœ

ä½¿ç”¨æ²¹çŒ´æ¥åŠ è½½

\> æœ¬æ€è·¯ä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–èµ„æºçš„åŠ è½½,ä¾‹å¦‚å›¾ç‰‡,json,xml,æ›´æ–°å…¬å‘Šä¿¡æ¯ç­‰ç­‰.

æ²¹çŒ´æä¾›äº†ä¸€ä¸ª[@resource](https://www.tampermonkey.net/documentation.php#_resource)çš„å±æ€§,ä¹Ÿå¯ä»¥ä½¿ç”¨**md5è¿›è¡Œæ ¡éªŒ**,è®©æ²¹çŒ´å°†èµ„æºé¢„åŠ è½½å¥½,ç„¶åå¯ä»¥é€šè¿‡[GM_getResourceURL](https://www.tampermonkey.net/documentation.php#GM_getResourceURL)å’Œ[GM_getResourceText](https://www.tampermonkey.net/documentation.php#GM_getResourceText)è·å–èµ„æºurlæˆ–è€…å†…å®¹.

è·å–åˆ°csså†…å®¹ä¹‹åå¯ä»¥é€šè¿‡[GM_addStyle](https://www.tampermonkey.net/documentation.php#GM_addStyle)å°†cssæ ·å¼æ·»åŠ åˆ°å‰ç«¯é¡µé¢.å°±åƒä¸‹é¢è¿™æ ·.

```
// @resource css https://blog.icodef.com/wp-content/themes/Kratos-3.0.7/assets/css/kratos.min.css?ver=3.2.4

console.log(GM_getResourceURL("css"),GM_getResourceText("css"));//urlæ˜¯ä¸€ä¸ªbase64çš„url
GM_addStyle(GM_getResourceText("css"));
```

ä½¿ç”¨è„šæœ¬åŠ è½½

è¿™ç§æ–¹æ³•ä¸ä¸Šé¢çš„åŠ è½½jsä¸€æ ·,ä¸å†åšè¿‡å¤šæè¿°,ç¼ºç‚¹å°±æ˜¯æ²¡æœ‰é¢„åŠ è½½å¥½èµ„æº,å¾ˆæ˜æ˜¾çš„æ„Ÿè§‰åˆ°äº†åˆ·æ–°çš„æ ·å­.

```
let script = document.createElement('link');
script.setAttribute('rel', 'stylesheet');
script.setAttribute('type', 'text/css');
script.href = "https://blog.icodef.com/wp-content/themes/Kratos-3.0.7/assets/css/kratos.min.css?ver=3.2.4";
document.documentElement.appendChild(script);
```

#### ç»™è®ºå›æ·»åŠ é»‘å¤œæ¨¡å¼

\> æˆ‘ä»¬ç›´æ¥å¼•å…¥å¤–éƒ¨jså°±å¯ä»¥äº†å•¦~è¿™é‡Œæ˜¯ä¸€ä¸ªdark modeçš„æ’ä»¶:[Darkmode.js](https://github.com/sandoche/Darkmode.js)

```
// ==UserScript==
// @name         è®ºå›é»‘å¤œæ¨¡å¼demo
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  ç»™ç½‘ç«™æ·»åŠ ä¸€ä¸ªé»‘å¤œæ¨¡å¼
// @author       You
// @match        https://bbs.tampermonkey.net.cn/*
// @run-at       document-start
// @grant        unsafeWindow
// @require https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js
// ==/UserScript==

unsafeWindow.onload=function(){
    //å› ä¸ºè¿™ä¸ªè„šæœ¬åªæ“ä½œdocument,æ‰€ä»¥åœ¨æ²™ç®±ç¯å¢ƒä¸­ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„
    new Darkmode().showWidget();
}
```

### å®æˆ˜ä¸€ä¸‹ï¼šä½¿æŸæ–°é—»ç½‘ç«™çš„è‡ªåŠ¨åŠ è½½ä¸‹ä¸€é¡µ

ç›®æ ‡ç½‘ç«™ï¼šIGh0dHBzOi8vd3d3LnBpbmd3ZXN0LmNvbS8=

é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨å…³é”®å­— @match æŒ‡å®šåŒ¹é…çš„ç½‘ç«™ URLï¼Œä½¿ç”¨ @grant è®¾ç½®æƒé™ GM_logï¼Œä½¿ç”¨å…³é”®å­—@run-at æŒ‡å®šæ‰§è¡Œæ—¶æœºä¸ºé¡µé¢åŠ è½½å®Œæˆï¼Œå³ï¼šdocument-end

```javascript
// ==UserScript==  
// @name         æ–°é—»æŸ¥çœ‹æ›´å¤š  
// @namespace    com.xag.more  
// @version      0.1  
// @license      GNU General Public License v3.0  
// @description  è‡ªåŠ¨æŸ¥çœ‹ä¸‹ä¸€é¡µ  
// @author       xingag  
// @match        ç›®æ ‡ç½‘ç«™  
// @icon         å›¾æ ‡iconåœ°å€  
// @grant        GM_log  
// @run-at       document-end  
// ==/UserScript==  
...

```

æ¥ç€ï¼Œæ·»åŠ ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œè·å–æ¯ä¸€é¡µåº•éƒ¨çš„åŠ è½½æ›´å¤šæŒ‰é’®

æœ€åï¼Œåˆ¤æ–­å…ƒç´ å­˜åœ¨æ—¶ï¼Œæ‰§è¡Œç‚¹å‡»æ“ä½œå³å¯

```javascript
...  
(function() {  
    'use strict';  
    console.log("location.hostname:",location.hostname)  
    if(location.hostname == "www.pingwest.com"){  
  
        setInterval(() => {  
            const more_element = document.querySelector(".load-more-box").querySelector("a")  
            if(more_element){  
                GM_log("å…ƒç´ å­˜åœ¨ï¼Œç‚¹å‡»åŠ è½½æ›´å¤šã€‚ã€‚ã€‚")  
                more_element.click();  
            }  
        }, 2000);  
    }  
})()  
...
```









æ³¨é‡Šæ–‡æ¡£éƒ¨åˆ†å‰åä½¿ç”¨`// ==UserScript==`ä¸`// ==/UserScript==`åŒ…å›´èµ·æ¥

å†™å¥½äº†é€»è¾‘ï¼Œä¹Ÿæœ¬åœ°æµ‹è¯•æå®šäº†ï¼Œä½†æ˜¯å°±æ˜¯ä¸æ‰§è¡Œï¼Œ

   åŸå› ï¼šæˆ‘çš„ match æ²¡æŒ‡å®šï¼Œgrantä¹Ÿæ²¡æŒ‡å®š

```python
// @grant        unsafeWindow
// @grant        GM_log  
// @grant        none  
```

   unsafeWindow	å…è®¸è„šæœ¬å¯ä»¥å®Œæ•´è®¿é—®åŸå§‹é¡µé¢ï¼ŒåŒ…æ‹¬åŸå§‹é¡µé¢çš„è„šæœ¬å’Œå˜é‡ã€‚ ç›¸å½“äºå…¨æ§åˆ¶ï¼Œè¶…çº§ç®¡ç†å‘˜

GM_log	

none	æ²¹çŒ´æä¾›äº†å¾ˆå¤šå¼ºå¤§çš„ APIï¼Œç”¨äºæ“ä½œç¼“å­˜åŠçª—å£ç­‰ï¼Œå¦‚æœä¸éœ€è¦ä½¿ç”¨è¿™äº› APIï¼Œå¯ä»¥å£°æ˜æƒé™ä¸º none

## matchçš„ä½¿ç”¨è®¾ç½®

â€‹      `// @match http://*` ç›¸å½“äºåœ¨ä»¥ http å¼€å¤´çš„æ‰€æœ‰ç½‘é¡µä¸­å¯ç”¨è¯¥è„šæœ¬

â€‹      `*`ç›¸å½“äºåœ¨æ‰€æœ‰ç½‘é¡µä¸­å¯ç”¨è¯¥è„šæœ¬

â€‹      `https://*` ç›¸å½“äºåœ¨ä»¥ httpså¼€å¤´çš„æ‰€æœ‰ç½‘é¡µä¸­å¯ç”¨è¯¥è„šæœ¬

â€‹      `http://www.baidu.com/*` ç›¸å½“äºåœ¨ä»¥ [http://www.baidu.com](http://www.baidu.com/) å¼€å¤´çš„æ‰€æœ‰ç½‘é¡µä¸­å¯ç”¨è¯¥è„šæœ¬ï¼Œå³åœ¨å’Œç™¾åº¦ç›¸å…³çš„ç½‘é¡µä¸­å¯ç”¨è¯¥è„šæœ¬

â€‹      `// @match *://blog.csdn.net/*` ç›¸å½“äºåœ¨ä»¥ åœ¨csdn çš„æ‰€æœ‰ç½‘é¡µä¸­å¯ç”¨è¯¥è„šæœ¬

#### ä½ å¯ä»¥è®¾ç½®å¤šä¸ªmatch

  ä¾‹å¦‚

```python
// @match        *://blog.csdn.net/*
// @match        *://www.zhihu.com/*
// @match        *://www.bilibili.com/*
```



CSDNï¼š[å¯å£å¯ä¹æ²¡æœ‰ä¹](https://blog.csdn.net/m0_59236602)

[5 åˆ†é’Ÿï¼Œæ•™ä½ ä»é›¶å¿«é€Ÿç¼–å†™ä¸€ä¸ªæ²¹çŒ´è„šæœ¬](https://blog.csdn.net/m0_59236602/article/details/124574318)